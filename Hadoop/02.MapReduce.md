## MapReduce

맵리듀스는 맵(Map)과 리듀스(Reduce) 두단계로 구성이 된다. 맵리듀스 작업이 끝나면 HDFS에 파일이 써진다.

- 맵(Map): Key와 Value를 이용하여 데이터를 그룹화와 정렬을 한다.
- 리듀스(Reduce): 맵 작업 결과에서 key 기준으로 각 리듀스로 분배하고 사용자가 정의한 방법으로 각 Key관련 정보를 추출하는 단계이다.

#### 맵 단계

1. 입력파일
   - HDFS에 있는 입력 파일을 분할하여 FileSplit을 생성
   - FileSplit 하나 당 맵 태스크(Map Task)
2. 맵(Map)
   - 데이터를 읽어 KV 페어(Key-value pair)를 생성
3. 컴바인(Combine)
   - 디스크에 쓰기 전에 KV 리스트에 대한 전처리를 수행 (e.g. Aggregation)
   - I/O와 네트워크 트래픽 감소를 위해 사용
4. 파티션
   - 키를 기준으로 디스크에 분할 저장
     - 기본적으로 해시 파티셔닝(Hsah Partioning)을 사용
   - 각 파티션은 키를 기준으로 정렬이 된다.
   - HDFS가 아닌 맴퍼의 Local File System에 저장
   - 분할된 각 파일은 각각 다른 리듀스 태스크에 저장

#### 리듀스 단계

1. 셔플 (Shuffle)
   - 여러 맵퍼에 있는 결과 파일을 각 리듀서에 할당
   - 리듀서에 할당된 결과 파일을 리듀서의 로컬 파일 시스템으로 복사
2. 정렬 (Sort)
   - 병합 정렬을 이요해 맵퍼 결과 파일을 정렬하여 Key로 정렬된 하나의 파일을 생성
3. 리듀스 (Reduce)
   - 정렬 단계에서 생성된 파일을 순차적으로 읽으며 리듀스 함수를 수행