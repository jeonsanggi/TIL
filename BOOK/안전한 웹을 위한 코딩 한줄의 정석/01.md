## 안전한 웹을 위한 코딩 한줄의 정석

```markdown
취약성이란? -> 실습 환경 -> 보안 기초 -> 취약성 패턴 및 대책 -> 대표적인 보안 기능 -> 웹 안전성을 높이기 위한 정책 -> 안전한 웹 어플리케이션 개발 프로세스
```

- <strong>취약성이란? -> 실습 환경 -> 보안 기초</strong>

### 취약성의 발생 원인

1. 버그에 의한 것: SQL 인젝션, XSS(Cross-Site Scripting) 등
2. 체크 기능 부족에 의한 것: 디렉토리 접근 공격(Directory Traversal)

### 웹 보안 기초

#### HTTP

- HTTP Request Message
  - Request Line:  메소드, URL(URI), 프로토콜 버전
  - Header: 호스트명(FQDN), 포트번호, Referer 등
- Response Message
  - Status Line : HTTP/1.1 200 OK
  - Header: Date, Server, Content-Length, Content-Type 등
  - Blank Line: Header의 끝을 나타내기 위해 개행만 있는 행
  - Body
- GET과 POST 사용 구분
  - GET 메소드는 참조(리로스 취득)에만 이용
    - GET은 URL상에 지정된 Parameter로 Referer가 유출 된다.
    - GET은 URL상에 지정된 Parameter가 액세스 로그에 남는다
  - POST 메소드는 비밀 정보를 전송, 전송할 데이터 양이 많은 경우
- hidden Parameter의 장점
  - 정보 유출이나 제 3자로부터 변경되는 것에 견고
  - 쿠키나 세션 변수는 세션 ID 고정화 공격에 약함
    - 로그인전 상태에로서, 지역별 도메인을 사용하고 있는 경우 쿠키 몬스터 문제(Cookie Monster Bug)로 세션 변수가 유출될 수 있음
  - 로그인 전의 상태에서는 세션 변수 사용을 피하고 hidden parameter를 사용하는 것이 안전

#### 세션관리

- HTTP는 Stateless하므로 서버 측에서는 상태를 보존하지 않는다.
- HTTP 인증을 사용하는 경우 브라우저에서는 ID와 Password를 기억해주지만, HTTP 인증을 사용하지 안흔 경우 서버에서 인증 상태를 기억해 둘 필요가 있다. 
- 이와 같은 어플리케이션의 상태를 기억해 두는 것을 세션 관리라고 하고, 세션 관리를 HTTP로 가능하게 하는 것이 쿠키이다. 
- 쿠키는 서버에서 브라우저에 대해 [이름=변수]의 형태로 기억한다.

##### 쿠키

1. 페이지가 로드되면서 웹 서버는 Response Header의 Set-Cookie로 브라우저에 쿠키 값을 기억하도록 한다.
2. 사용자가 아이디와 비밀번호를 입력하여 로그인 버튼을 누르면 Request에 쿠를 포함하여 서버로 전송한다.
3. 이후 같은 사이트에 Reqeust를 전송할때 브라우저에서 기억하고 있는 쿠키값을 전송한다.

하지만, 쿠키는 보존 가능한 값의 개수와 문자열의 길이에 제한이 있고, 사용자 본인이 참조 변경이 가능하여 비밀 정보를 넣어두는데 적합하지 않다. 그러므로 쿠키에는 세션 ID를 넣어두고 실제 값은 서버 측에서 관리하는 방법으로 사용된다.

세션 ID를 보호하기 위해서 SSL에 의한 암호화가 유용한 방법이지만, 쿠키를 발행할 때 속성 지정에 주의가 필요하다.

| 속성     | 의미                                                    |
| -------- | ------------------------------------------------------- |
| Domain   | 브라우저가 쿠키값을 전송할 서버의 도메인                |
| Path     | 브라우저가 쿠키값을 전송할 URL 디렉토리                 |
| Expires  | 쿠키값의 유효기간. (기본 값은 브라우저가 종료될 때까지) |
| Secure   | SSL의 경우에만 쿠키를 전송                              |
| HttpOnly | 이 속성이 지정된 쿠키는 JavaScript에서 접근 불가능      |

- Domain 속성은 복수의 서버로 쿠키를 전송하고 싶은 경우 사용하지만, 보통 설정하지 않는다.

#### SOP(Same Origin Policy)

어떤 출처에서 불러온 문서나 스크립트가 다른 출처에서 가져온 리소스와 상호작용하는 것을 제한하는 보안 방식이다.

예를 들어, iframe의 정보를 JavaScript로 읽을 수 있기 때문에 이를 악용한 공격이 가능할 수 있다. 공격자가 iframe을 통해 javascript를 실행하려고 할 때 SOP를 통해 다른 호스트에 있는 JavaScript에서 액세스를 거부하여 보안상의 문제를 해결한다.

##### 크로스 도메인 엑세스가 허가되는 경우

- iframe 태그 및 frame 태그: 크로스 도메인 액세스가 가능하지만 javascript에 의해 크로스 도메인의 도큐먼트에 액세스하는 것이 금지 되어 있음
- img 태그: src 속성은 크로스 도메인을 지정하는 것이 가능
- script 태그: src 속성을 지정하면 다른 사이트에서 JavaScript를 읽을 수 있음
- css: @import로 크로스 도메인에서 읽어 올수 있음
- form 태그: action 속성으로 크로스 도메인의 지정이 가능. form 태그는 CSRF 공격을 받을 수 있음
